<div class="task" *ngIf="problem">
  <div class="content" [innerHTML]="problem.text | marked"></div>
  <div class="tests" *ngIf="problem.tests.length">
    <h2>Примеры</h2>
    <div class="test" *ngFor="let test of problem.tests, let i = index">
      <p *ngIf="problem.tests.length > 1"><b>Пример {{i + 1}}</b></p>
      <i>Входные данные</i>
      <pre class="data">{{test.input}}</pre>
      <i>Выходные данные</i>
      <pre class="data">{{test.output}}</pre>
      <hr>
    </div>

    <div class="send">
      <h2>Отправить решение</h2>
      <div class="ace-container">
        <ace mode="java" theme="github"
             [(value)]="solution"
             (valueChange)="editSubject.next($event)"></ace>
      </div>
    </div>

    <div class="panel-button">
      <div *ngIf="!(sending || running)">
        <app-next-step *ngIf="status" [problemId]="problemId" [subtopicId]="subtopicId"></app-next-step>
        <button *ngIf="!status || !bestLastSubmission" mat-raised-button (click)="send()" [disabled]="isSendDisabled()"
                color="primary">Отправить
        </button>
        <button *ngIf="status || !bestLastSubmission" mat-raised-button color="primary" (click)="status = null">
          Решить снова
        </button>
      </div>
      <div *ngIf="(sending || running)">
        <mat-spinner diameter="35"></mat-spinner>
      </div>
      <div *ngIf="hints.length === 0">
        <button *ngIf="this.problem.hintsCount !== this.hints.length" mat-raised-button color="accent"
                (click)="sendHint();">Взять подсказку
        </button>
        <button *ngIf="this.problem.hintsCount === this.hints.length" mat-raised-button [disabled]="true">Нет подсказок
        </button>
      </div>
    </div>

    <mat-accordion multi [style.display]="hints.length > 0 ? 'block' : 'none'">
      <mat-expansion-panel style="margin: 10px 0; box-shadow: none; background: none;"
                           (opened)="panelOpenState = true"
                           (closed)="panelOpenState = false">
        <mat-expansion-panel-header>
          <mat-panel-title class="button-hint-bottom">
            подсказки
          </mat-panel-title>
        </mat-expansion-panel-header>
        <div *ngFor="let hint of hints">
          <p [innerHTML]="hint.text | marked"></p>
        </div>
      </mat-expansion-panel>
    </mat-accordion>

    <div *ngIf="hints.length !== 0" class="button-hint-bottom">
      <button mat-raised-button color="accent" (click)="sendHint();"
              [disabled]="this.problem.hintsCount === this.hints.length && panelOpenState">
        {{panelOpenState ? 'Взять подсказку' : 'Открыть подсказки'}}
      </button>
    </div>

    <div class="submissions" *ngIf="listSubmissions && listSubmissions.length">
      <table mat-table [dataSource]="listSubmissions">

        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef>Тип</th>
          <td mat-cell *matCellDef="let element; let i = index">{{getType(i)}}</td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Статус</th>
          <td mat-cell *matCellDef="let element">{{element.status}}</td>
        </ng-container>

        <ng-container matColumnDef="wrongTest">
          <th mat-header-cell *matHeaderCellDef>Непройденный тест</th>
          <td mat-cell
              *matCellDef="let element">{{element.wrongTest ? element.wrongTest + ' / ' + problem.totalTests : ''}}</td>
        </ng-container>

        <ng-container matColumnDef="maxExecutionTime">
          <th mat-header-cell *matHeaderCellDef>Время выполнения</th>
          <td mat-cell *matCellDef="let element">{{element.maxExecutionTime}} мс</td>
        </ng-container>

        <ng-container matColumnDef="maxUsedMemory">
          <th mat-header-cell *matHeaderCellDef>Память</th>
          <td mat-cell *matCellDef="let element">{{element.maxUsedMemory}}</td>
        </ng-container>

        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef>Дата</th>
          <td mat-cell *matCellDef="let element">{{element.sentDate | date:'dd MMMM yyyy':null:'ru'}}</td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>&nbsp;</th>
          <td mat-cell *matCellDef="let row">
            <button mat-button *ngIf="showMore(row)" (click)="seeMore(row)">Подробнее</button>
            <mat-spinner *ngIf="isRunning(row)" diameter="16"></mat-spinner>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>
  </div>
</div>
