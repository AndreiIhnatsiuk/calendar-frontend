<div class="task" *ngIf="task">
  <div class="content" [innerHTML]="task.content | marked"></div>
  <div class="tests" *ngIf="task.tests.length">
    <h2>Примеры</h2>
    <div class="test" *ngFor="let test of task.tests, let i = index">
      <p *ngIf="task.tests.length > 1"><b>Пример {{i + 1}}</b></p>
      <i>Входные данные</i>
      <pre class="data">{{test.input}}</pre>
      <i>Выходные данные</i>
      <pre class="data">{{test.output}}</pre>
      <hr>
    </div>

    <div class="send">
      <h2>Отправить решение</h2>
      <div class="ace-container">
        <ace mode="java" theme="github"
             [(value)]="solution"
             (valueChange)="editSubject.next($event)"></ace>
      </div>

      <div style="margin-bottom: 10px; display: flex; justify-content: space-between">
        <div *ngIf="!(sending || running)">
          <app-next-step *ngIf="status" [taskId]="taskId" [subtopicId]="subtopicId"></app-next-step>
          <button *ngIf="!status || !submissions" mat-raised-button (click)="send()" [disabled]="isSendDisabled()"
                  color="primary">Отправить
          </button>
          <button *ngIf="status || !submissions" mat-raised-button color="primary" (click)="status = null">Решить
            снова
          </button>
        </div>
        <div *ngIf="(sending || running)">
          <mat-spinner diameter="35"></mat-spinner>
        </div>
        <div *ngIf="hints.length === 0">
          <button *ngIf="this.task.hintsCount !== this.hints.length" mat-raised-button color="accent"
                  (click)="sendHint();">Взять подсказку
          </button>
          <button *ngIf="this.task.hintsCount === this.hints.length" mat-raised-button [disabled]="true">Нет подсказок
          </button>
        </div>
      </div>

      <mat-accordion multi style="margin-bottom: 10px; " [style.display]="hints.length > 0?'block':'none'">
        <mat-expansion-panel style="box-shadow: none; background: none"
                             (opened)="panelOpenState = true"
                             (closed)="panelOpenState = false">
          <mat-expansion-panel-header>
            <mat-panel-title style="display: flex; justify-content: flex-end">
              подсказки
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div *ngFor="let hint of hints" class="hint">
            <p [innerHTML]="hint.text | marked"></p>
          </div>
        </mat-expansion-panel>
      </mat-accordion>

      <div *ngIf="hints.length !== 0" class="button-hint-bottom">
        <button mat-raised-button color="accent" (click)="sendHint();"
                [disabled]="this.task.hintsCount === this.hints.length && panelOpenState">
          {{panelOpenState ? 'Взять подсказку' : 'Открыть подсказки'}}
        </button>
      </div>
    </div>

    <div class="submissions" *ngIf="submissions && submissions.length">
      <table mat-table [dataSource]="submissions">

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Статус</th>
          <td mat-cell *matCellDef="let element">{{element.status}}</td>
        </ng-container>

        <ng-container matColumnDef="wrongTest">
          <th mat-header-cell *matHeaderCellDef>Непройденный тест</th>
          <td mat-cell
              *matCellDef="let element">{{element.wrongTest ? element.wrongTest + ' / ' + task.totalTests : ''}}</td>
        </ng-container>

        <ng-container matColumnDef="maxExecutionTime">
          <th mat-header-cell *matHeaderCellDef>Время выполнения</th>
          <td mat-cell *matCellDef="let element">{{element.maxExecutionTime}} мс</td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>&nbsp;</th>
          <td mat-cell *matCellDef="let row">
            <button mat-button *ngIf="showMore(row)" (click)="seeMore(row)">Подробнее</button>
            <mat-spinner *ngIf="isRunning(row)" diameter="16"></mat-spinner>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>
  </div>
</div>
